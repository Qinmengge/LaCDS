library(devtools)
load_all
load_all()
load_all()
setwd("~/Desktop/research/Kevin He/discrete_survival_EM/Paper/")
source("Sim_general.R")
library(devtools)
load_all()
library(roxygen2)
compileAttributes()
load_all()
load_all()
.Last.error
library(devtools)
load_all()
load_all()
load_all()
load_all()
load_all()
load_all()
Data=read.csv("~/Desktop/research/Kevin He/discrete_survival_EM/EM/SRTR_data/Data/Di/example_cleaned_data_07_12.csv",header = T)
# by week
t=floor(Data$time/7)+1
ind=Data$event
X=Data[,c(-1,-119,-120,-121)]
X=X[,c("time_ESRD_1_5","time_ESRD_5","DON_AGE_10","DON_AGE_10_20",
"DON_AGE_30_40","DON_AGE_40_50","DON_AGE_50_60","DON_AGE_60"
,"DON_RACE_asian","DON_RACE_black","DON_EXPAND_DON_KI2","CAN_GENDER_M",
"CAN_RACE_SRTR_asian","CAN_RACE_SRTR_black","REC_BMI_obesity"
,"REC_BMI_over","REC_BMI_under","REC_COLD_ISCH_TM_20",
"REC_AGE_AT_TX_18_25","REC_AGE_AT_TX_35_45","REC_AGE_AT_TX_45_50",
"REC_AGE_AT_TX_50_55","REC_AGE_AT_TX_55_60","REC_AGE_AT_TX_60_65",
"REC_AGE_AT_TX_65_70","REC_AGE_AT_TX_70_75","REC_AGE_AT_TX_75",
"CAN_DIAB_2","CAN_DIAB_3","DON_GENDER_M","REC_PREV_KI","DON_HTN2",
"DON_BMI_obesity","DON_BMI_over","DON_BMI_under")]
load_all()
rst=list()
AIC=c()
maxt=max(t)
c=ncol(X)
r=nrow(X)
# order t
od=order(t,decreasing = T)
t=t[od]
ind=ind[od]
X=as.matrix(X[od,])
maxt
#kernal
nker=maxt
rho=0.05
kernal=rep(seq(1,maxt,length.out=nker),each=maxt)
#kernal=rep(c(9,17,23,29,34,39,44,49,52,53),each=maxt)
dim(kernal)=c(maxt,nker)
t_seq=rep(1:maxt,nker)
dim(t_seq)=c(maxt,nker)
wker=exp(-rho*(t_seq-kernal)^2)
wker=wker/rowSums(wker)
#formatting
ind=t(t(ind))
ker=t(t(c(rep(0,nker))))
beta_t=t(t(c(rep(0,maxt))))
beta_v=t(t(rep(0,c)))
t=t(t(t))
Z=cbind(rep(1,r))
res1=EM(wker,Z=Z,group=1 ,t, X, ind, beta_t, beta_v, tol = 0.1, tol2=0.0001, max_iter = 1000, alpha=0.5)
load_all()
load_all()
Data=read.csv("~/Desktop/research/Kevin He/discrete_survival_EM/EM/SRTR_data/Data/Di/example_cleaned_data_07_12.csv",header = T)
# by week
t=floor(Data$time/7)+1
ind=Data$event
X=Data[,c(-1,-119,-120,-121)]
X=X[,c("time_ESRD_1_5","time_ESRD_5","DON_AGE_10","DON_AGE_10_20",
"DON_AGE_30_40","DON_AGE_40_50","DON_AGE_50_60","DON_AGE_60"
,"DON_RACE_asian","DON_RACE_black","DON_EXPAND_DON_KI2","CAN_GENDER_M",
"CAN_RACE_SRTR_asian","CAN_RACE_SRTR_black","REC_BMI_obesity"
,"REC_BMI_over","REC_BMI_under","REC_COLD_ISCH_TM_20",
"REC_AGE_AT_TX_18_25","REC_AGE_AT_TX_35_45","REC_AGE_AT_TX_45_50",
"REC_AGE_AT_TX_50_55","REC_AGE_AT_TX_55_60","REC_AGE_AT_TX_60_65",
"REC_AGE_AT_TX_65_70","REC_AGE_AT_TX_70_75","REC_AGE_AT_TX_75",
"CAN_DIAB_2","CAN_DIAB_3","DON_GENDER_M","REC_PREV_KI","DON_HTN2",
"DON_BMI_obesity","DON_BMI_over","DON_BMI_under")]
rst=list()
AIC=c()
maxt=max(t)
c=ncol(X)
r=nrow(X)
# order t
od=order(t,decreasing = T)
t=t[od]
ind=ind[od]
X=as.matrix(X[od,])
#kernal
nker=maxt
rho=0.05
kernal=rep(seq(1,maxt,length.out=nker),each=maxt)
#kernal=rep(c(9,17,23,29,34,39,44,49,52,53),each=maxt)
dim(kernal)=c(maxt,nker)
t_seq=rep(1:maxt,nker)
dim(t_seq)=c(maxt,nker)
wker=exp(-rho*(t_seq-kernal)^2)
wker=wker/rowSums(wker)
#formatting
ind=t(t(ind))
ker=t(t(c(rep(0,nker))))
beta_t=t(t(c(rep(0,maxt))))
beta_v=t(t(rep(0,c)))
t=t(t(t))
g=1
Z=cbind(rep(1,r))
res1=EM(wker,Z=Z,group=1 ,t, X, ind, beta_t, beta_v, tol = 0.1, tol2=0.0001, max_iter = 1000, alpha=0.5)
load_all()
library(devtools)
load_all()
load_all()
EM{}
EM()
load_all()
load_all()
load_all()
load_all()
library(devtools)
library(roxygen2)
load_all()
load_all()
library(roxygen2)
load_all()
library(Rcpp)
load_all()
compileAttributes()
load_all()
library(devtools)
library(roxygen2)
library(Rcpp)
load_all()
compileAttributes()
load_all()
Data=read.csv("~/Desktop/research/Kevin He/discrete_survival_EM/EM/SRTR_data/Data/Di/example_cleaned_data_07_12.csv",header = T)
# by week
t=floor(Data$time/7)+1
ind=Data$event
X=Data[,c(-1,-119,-120,-121)]
X=X[,c("time_ESRD_1_5","time_ESRD_5","DON_AGE_10","DON_AGE_10_20",
"DON_AGE_30_40","DON_AGE_40_50","DON_AGE_50_60","DON_AGE_60"
,"DON_RACE_asian","DON_RACE_black","DON_EXPAND_DON_KI2","CAN_GENDER_M",
"CAN_RACE_SRTR_asian","CAN_RACE_SRTR_black","REC_BMI_obesity"
,"REC_BMI_over","REC_BMI_under","REC_COLD_ISCH_TM_20",
"REC_AGE_AT_TX_18_25","REC_AGE_AT_TX_35_45","REC_AGE_AT_TX_45_50",
"REC_AGE_AT_TX_50_55","REC_AGE_AT_TX_55_60","REC_AGE_AT_TX_60_65",
"REC_AGE_AT_TX_65_70","REC_AGE_AT_TX_70_75","REC_AGE_AT_TX_75",
"CAN_DIAB_2","CAN_DIAB_3","DON_GENDER_M","REC_PREV_KI","DON_HTN2",
"DON_BMI_obesity","DON_BMI_over","DON_BMI_under")]
rst=list()
AIC=c()
maxt=max(t)
c=ncol(X)
r=nrow(X)
# order t
od=order(t,decreasing = T)
t=t[od]
ind=ind[od]
X=as.matrix(X[od,])
#kernal
nker=maxt
rho=0.05
kernal=rep(seq(1,maxt,length.out=nker),each=maxt)
#kernal=rep(c(9,17,23,29,34,39,44,49,52,53),each=maxt)
dim(kernal)=c(maxt,nker)
t_seq=rep(1:maxt,nker)
dim(t_seq)=c(maxt,nker)
wker=exp(-rho*(t_seq-kernal)^2)
wker=wker/rowSums(wker)
#formatting
ind=t(t(ind))
ker=t(t(c(rep(0,nker))))
beta_t=t(t(c(rep(0,maxt))))
beta_v=t(t(rep(0,c)))
t=t(t(t))
Z=cbind(rep(1,r))
res1=EM(wker,Z=Z,group=1 ,t, X, ind, beta_t, beta_v, tol = 0.1, tol2=0.0001, max_iter = 1000, alpha=0.5)
load_all()
res1=EM(wker,Z=Z,group=1 ,t, X, ind, beta_t, beta_v, tol = 0.1, tol2=0.0001, max_iter = 1000, min_iter=1, alpha=0.5)
load_all()
compileAttributes()
load_all()
res1=EM(wker,Z=Z,group=1 ,t, X, ind, beta_t, beta_v, tol = 0.1, tol2=0.0001, max_iter = 1000, min_iter=1, alpha=0.5)
res1$Beta_v
res1$Beta_t
res1$Beta_v
res_bp=res1
load("../../Paper/Real_DS_1sub.RData")
res1$Beta_v
res1$likelihood
res_bp$likelihood
res1=EM(wker,Z=Z,group=1 ,t, X, ind, beta_t, beta_v, tol = 0.0001, tol2=0.0001, max_iter = 1000, min_iter=1, alpha=0.5)
head(t)
res1$likelihood
load_all()
Data=read.csv("~/Desktop/research/Kevin He/discrete_survival_EM/EM/SRTR_data/Data/Di/example_cleaned_data_07_12.csv",header = T)
# by week
t=floor(Data$time/7)+1
ind=Data$event
X=Data[,c(-1,-119,-120,-121)]
X=X[,c("time_ESRD_1_5","time_ESRD_5","DON_AGE_10","DON_AGE_10_20",
"DON_AGE_30_40","DON_AGE_40_50","DON_AGE_50_60","DON_AGE_60"
,"DON_RACE_asian","DON_RACE_black","DON_EXPAND_DON_KI2","CAN_GENDER_M",
"CAN_RACE_SRTR_asian","CAN_RACE_SRTR_black","REC_BMI_obesity"
,"REC_BMI_over","REC_BMI_under","REC_COLD_ISCH_TM_20",
"REC_AGE_AT_TX_18_25","REC_AGE_AT_TX_35_45","REC_AGE_AT_TX_45_50",
"REC_AGE_AT_TX_50_55","REC_AGE_AT_TX_55_60","REC_AGE_AT_TX_60_65",
"REC_AGE_AT_TX_65_70","REC_AGE_AT_TX_70_75","REC_AGE_AT_TX_75",
"CAN_DIAB_2","CAN_DIAB_3","DON_GENDER_M","REC_PREV_KI","DON_HTN2",
"DON_BMI_obesity","DON_BMI_over","DON_BMI_under")]
rst=list()
AIC=c()
maxt=max(t)
c=ncol(X)
r=nrow(X)
# order t
od=order(t,decreasing = T)
t=t[od]
ind=ind[od]
X=as.matrix(X[od,])
#kernal
nker=maxt
rho=100
kernal=rep(seq(1,maxt,length.out=nker),each=maxt)
#kernal=rep(c(9,17,23,29,34,39,44,49,52,53),each=maxt)
dim(kernal)=c(maxt,nker)
t_seq=rep(1:maxt,nker)
dim(t_seq)=c(maxt,nker)
wker=exp(-rho*(t_seq-kernal)^2)
wker=wker/rowSums(wker)
#formatting
ind=t(t(ind))
ker=t(t(c(rep(0,nker))))
beta_t=t(t(c(rep(0,maxt))))
beta_v=t(t(rep(0,c)))
t=t(t(t))
Z=cbind(rep(1,r))
res1=EM(wker,Z=Z,group=1 ,t, X, ind, beta_t, beta_v, tol = 0.0001, tol2=0.0001, max_iter = 1000, min_iter=0, alpha=0.5)
res1$likelihood
res1$Beta_v
lik1=lik(t, X, ind, res$Beta_t, res$Beta_v, t(t(colMeans(res$Z))), maxt, r, c, i)
res=res1
lik1=lik(t, X, ind, res$Beta_t, res$Beta_v, t(t(colMeans(res$Z))), maxt, r, c, i)
g=1
lik1=lik(t, X, ind, res$Beta_t, res$Beta_v, t(t(colMeans(res$Z))), maxt, r, c, g)
lik1
AIC=c(AIC,(length(res$Beta_t)+length(res$Beta_v))*2-2*lik1$likeli2)
AIC
maxt
se1=sqrt(diag(solve(res$Info+diag(rep(0.0000001,maxt+c)))))
se1
library(devtools)
load_all()
Data=read.csv("~/Desktop/research/Kevin He/discrete_survival_EM/EM/SRTR_data/Data/Di/example_cleaned_data_07_12.csv",header = T)
# by week
t=floor(Data$time/7)+1
ind=Data$event
X=Data[,c(-1,-119,-120,-121)]
X=X[,c("time_ESRD_1_5","time_ESRD_5","DON_AGE_10","DON_AGE_10_20",
"DON_AGE_30_40","DON_AGE_40_50","DON_AGE_50_60","DON_AGE_60"
,"DON_RACE_asian","DON_RACE_black","DON_EXPAND_DON_KI2","CAN_GENDER_M",
"CAN_RACE_SRTR_asian","CAN_RACE_SRTR_black","REC_BMI_obesity"
,"REC_BMI_over","REC_BMI_under","REC_COLD_ISCH_TM_20",
"REC_AGE_AT_TX_18_25","REC_AGE_AT_TX_35_45","REC_AGE_AT_TX_45_50",
"REC_AGE_AT_TX_50_55","REC_AGE_AT_TX_55_60","REC_AGE_AT_TX_60_65",
"REC_AGE_AT_TX_65_70","REC_AGE_AT_TX_70_75","REC_AGE_AT_TX_75",
"CAN_DIAB_2","CAN_DIAB_3","DON_GENDER_M","REC_PREV_KI","DON_HTN2",
"DON_BMI_obesity","DON_BMI_over","DON_BMI_under")]
rst=list()
AIC=c()
maxt=max(t)
c=ncol(X)
r=nrow(X)
# order t
od=order(t,decreasing = T)
t=t[od]
ind=ind[od]
X=as.matrix(X[od,])
#kernal
nker=maxt
rho=100
kernal=rep(seq(1,maxt,length.out=nker),each=maxt)
#kernal=rep(c(9,17,23,29,34,39,44,49,52,53),each=maxt)
dim(kernal)=c(maxt,nker)
t_seq=rep(1:maxt,nker)
dim(t_seq)=c(maxt,nker)
wker=exp(-rho*(t_seq-kernal)^2)
wker=wker/rowSums(wker)
#formatting
ind=t(t(ind))
ker=t(t(c(rep(0,nker))))
beta_t=t(t(c(rep(0,maxt))))
beta_v=t(t(rep(0,c)))
t=t(t(t))
g=2
z=sample(1:g,r,replace = T)
Z=matrix(rep(0,r*g),nrow = r)
for (i in 1:g){
Z[z==i,i]=1
}
res=EM(wker,Z=Z,group=1 ,t, X, ind, beta_t, beta_v, tol = 0.0001, tol2=0.0001, max_iter = 1000, min_iter=0, alpha=0.5)
g
t(t(colMeans(res$Z)))
